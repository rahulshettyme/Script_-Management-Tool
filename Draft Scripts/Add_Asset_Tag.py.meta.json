{
    "name": "Add_Asset_Tag.py",
    "filename": "Add_Asset_Tag.py",
    "team": "Unassigned",
    "description": "Add tags to Assets. \nNote: This script will update tag in excel to existing tags. It wont delete the existing tag.",
    "expected_columns": [],
    "columns": [],
    "requiresLogin": true,
    "isMultithreaded": true,
    "batchSize": "10",
    "groupByColumn": "",
    "enableGeofencing": false,
    "allowAdditionalAttributes": false,
    "additionalAttributes": [],
    "outputConfig": {
        "uiMapping": [
            {
                "colName": "Asset Name",
                "value": "",
                "logic": "from excel"
            },
            {
                "colName": "Asset ID",
                "value": "",
                "logic": "from excel"
            },
            {
                "colName": "Tag Name",
                "value": "",
                "logic": "from excel"
            },
            {
                "colName": "Status",
                "value": "",
                "logic": "Pass if asset update API status code is 200 or 201, else Fail"
            }
        ],
        "aiInstructions": "",
        "excelMapping": [
            {
                "colName": "Tag ID",
                "value": "",
                "logic": "attribute 'id' from asset tag API response"
            },
            {
                "colName": "Status",
                "value": "",
                "logic": "'Fail' if tag not found or if status code of asset update is not 200 or 201\n'Pass' if status of asset update is 200 or 201"
            },
            {
                "colName": "Response",
                "value": "",
                "logic": "'Tag not found' if tag not found or \nwhole response of asset update if status code is not 200 or 201\n'Tag updated to asset' if asset update response code is 200 or 201"
            }
        ],
        "isDynamicUI": true
    },
    "generationPrompt": "Script Name: Add_Asset_Tag\nExcel Columns: Asset Name, Asset ID, Tag Name, Tag ID, Status, Response\n\nOUTPUT MAPPING CONFIGURATION:\n- UI Output Definition:\n- UI Column 'Asset Name': Set to '' (Logic: from excel)\n- UI Column 'Asset ID': Set to '' (Logic: from excel)\n- UI Column 'Tag Name': Set to '' (Logic: from excel)\n- UI Column 'Status': Set to '' (Logic: Pass if asset update API status code is 200 or 201, else Fail)\n- Excel Output Definition:\n   - Column 'Tag ID': Set to '' (Logic: attribute 'id' from asset tag API response)\n   - Column 'Status': Set to '' (Logic: 'Fail' if tag not found or if status code of asset update is not 200 or 201\n'Pass' if status of asset update is 200 or 201)\n   - Column 'Response': Set to '' (Logic: 'Tag not found' if tag not found or \nwhole response of asset update if status code is not 200 or 201\n'Tag updated to asset' if asset update response code is 200 or 201)\nIMPORTANT: Include this configuration as a comment block at the top of the generated Python script for reference.\n\nStep 1 [MASTER]:\n  - Master Type: assettag\n  - Input Column: Tag Name\n  - Output Column: Tag ID\n  - Lookup Path: id\n  - On Failure: Skip Row\n  - Run Method: once\n  - IMPORTANT: You MUST import and use 'components.master_search' for this step.\n  - CRITICAL OPTIMIZATION: This master type is configured as 'Run Once'.\n  - 1. use 'master_search.fetch_all(\"assettag\", env_config)' OUTSIDE the loop to get all items.\n  - 2. use 'master_search.lookup_from_cache(cache_data, \"name\", input_value, \"id\")' INSIDE the loop.\n  - 3. Do NOT use 'master_search.search()' inside the loop for this type.\n\nStep 2 [API]:\n  - Step/Variable Name: Fetch Asset Details\n  - Call GET /services/farm/api/assets/{Asset ID}\n  - Payload Type: QUERY\n  - Expected Response: {  \"id\" : 5936151,  \"name\" : \"RS AI 1\",  \"companyStatus\" : null,  \"data\" : {    \"rajaAssetAddAttr\" : \"2026-02-14T00:00:00.000Z\",    \"tags\" : [ 5929601 ]  },  \"ownerId\" : 5917951,  \"ownerFirstName\" : \"RS F 25311001\",  \"soilType\" : {    \"id\" : 1056,    \"name\" : \"Clay Loam\",    \"description\" : \"Clay Loam Soil Type Description\",    \"data\" : null,    \"clientId\" : \"115825fe-a0d3-4c95-a831-1dc4fa93d261\"  },  \"irrigationType\" : {    \"id\" : 1101,    \"name\" : \"Bore well\",    \"description\" : \"Bore well Irrigation Type Description\",    \"clientId\" : \"8db73384-94ab-43ad-9827-0ca9f30e2eea\",    \"data\" : null  },  \"surveyNumber\" : null,  \"leased\" : null,  \"auditedArea\" : null,  \"usableArea\" : {    \"count\" : 5.0  },  \"declaredArea\" : {    \"count\" : 5.0  },  \"availableArea\" : null,  \"images\" : { },  \"assetStatus\" : \"AVAILABLE\",  \"clientId\" : \"0705162e-dd48-47f6-bfd3-bf7d5950d24d\",  \"address\" : {    \"id\" : 5935832,    \"formattedAddress\" : \"Madhugiri, Karnataka 572132, India\",    \"postalCode\" : \"572132\",    \"locality\" : \"Madhugiri\",    \"data\" : null,    \"administrativeAreaLevel5\" : null,    \"administrativeAreaLevel4\" : null,    \"administrativeAreaLevel3\" : null,    \"administrativeAreaLevel2\" : \"Bangalore Division\",    \"administrativeAreaLevel1\" : \"Karnataka\",    \"country\" : \"India\",    \"latitude\" : 13.6643166,    \"longitude\" : 77.20889869999999,    \"placeId\" : \"ChIJsfkoVqO0sTsRLbvVqd06cTU\",    \"sublocalityLevel1\" : \"\",    \"sublocalityLevel2\" : \"\",    \"sublocalityLevel3\" : null,    \"sublocalityLevel4\" : null,    \"sublocalityLevel5\" : null,    \"houseNo\" : \"\",    \"buildingName\" : \"\",    \"landmark\" : \"\",    \"clientId\" : \"bf7fa3dc-56c8-4059-951f-681a76f1507f\"  },  \"ownerCode\" : \"RSF25311001\",  \"nameCounter\" : null,  \"acreSquareAssetId\" : null,  \"lastModifiedDate\" : \"2026-02-14T12:32:48.587Z\",  \"ownerClientId\" : \"ea8e94f6-8771-4b72-9ba7-875f86279d79\",  \"externalId\" : null,  \"massUpload\" : false,  \"deleted\" : false}\n  - Instructions: Fetches the complete details of the target farmer using the resolved farmer ID.\n\nStep 3 [LOGIC]:\n  - Logic: Extracts current tags from asset_data['data']['tags']. If the resolved tag_id is not already present, it's added to the list of tags. If the ['data']['tags'] directory not present add it. Prepares the asset_data object for the PUT request.\n\nStep 4 [API]:\n  - Step/Variable Name: Update Asset Tags\n  - Call PUT /services/farm/api/assets\n  - Payload Type: DTO_FILE\n  - Payload Example: {\"dto\": {\"data\": {\"tags\": [\"list of tag IDs\"]}}} | Structure: Updates nested data.data (array)\n  - Expected Response: put_resp\n  - Instructions: Sends the updated asset_data (including new tags) to the API to update the asset. Only executed if a new tag was added.\n\n",
    "draftSource": "Add_Asset_Tag"
}