{
    "name": "AddAsset.py",
    "filename": "AddAsset.py",
    "team": "Unassigned",
    "description": "Add farmer by searching the farmer, Soil Type, Irrigation Type using the names provided\nNote: If tenant has additional attributes, select the checkbox and mention attribute key to get column in Excel",
    "expected_columns": [
        "Asset Name",
        "Farmer Name",
        "Soil Type",
        "Irrigation Type",
        "Address",
        "Declared Area"
    ],
    "columns": [
        {
            "name": "Asset Name",
            "type": "Mandatory",
            "description": "Asset Name"
        },
        {
            "name": "Farmer Name",
            "type": "Mandatory",
            "description": "Auto-detected"
        },
        {
            "name": "Soil Type",
            "type": "Mandatory",
            "description": "Auto-detected"
        },
        {
            "name": "Irrigation Type",
            "type": "Mandatory",
            "description": "Auto-detected"
        },
        {
            "name": "Address",
            "type": "Mandatory",
            "description": "Auto-detected"
        },
        {
            "name": "Declared Area",
            "type": "Mandatory",
            "description": "Auto-detected"
        }
    ],
    "requiresLogin": true,
    "isMultithreaded": true,
    "batchSize": "10",
    "groupByColumn": "",
    "enableGeofencing": false,
    "allowAdditionalAttributes": true,
    "additionalAttributes": [],
    "outputConfig": {
        "uiMapping": [
            {
                "colName": "Asset Name",
                "value": "Asset Name",
                "logic": "from excel column 'Asset Name'"
            },
            {
                "colName": "Status",
                "value": "",
                "logic": "'Pass' if Asset create response in 200 or 201, else 'Fail'"
            },
            {
                "colName": "Asset ID",
                "value": "",
                "logic": "attribute 'id' from response of asset create if status is pass, else 'NA'"
            }
        ],
        "aiInstructions": "",
        "excelMapping": [
            {
                "colName": "Asset ID",
                "value": "id",
                "logic": "attribute 'id' from response of asset create if status is pass, else 'NA'"
            },
            {
                "colName": "Response",
                "value": "",
                "logic": "'Asset Created Successfully' if asset creation is success\nor 'Farmer not Found' if farmer find is failed\nActual response if asset creation failed"
            }
        ],
        "isDynamicUI": true
    },
    "generationPrompt": "Script Name: AddAsset\nExcel Columns: Asset Name, Farmer Name, Soil Type, Irrigation Type, Address, Declared Area\n\nOUTPUT MAPPING CONFIGURATION:\n- UI Output Definition:\n- UI Column 'Asset Name': Set to 'Asset Name' (Logic: from excel column 'Asset Name')\n- UI Column 'Status': Set to '' (Logic: 'Pass' if Asset create response in 200 or 201, else 'Fail')\n- UI Column 'Asset ID': Set to '' (Logic: attribute 'id' from response of asset create if status is pass, else 'NA')\n- Excel Output Definition:\n   - Column 'Asset ID': Set to 'id' (Logic: attribute 'id' from response of asset create if status is pass, else 'NA')\n   - Column 'Response': Set to '' (Logic: 'Asset Created Successfully' if asset creation is success\nor 'Farmer not Found' if farmer find is failed\nActual response if asset creation failed)\nIMPORTANT: Include this configuration as a comment block at the top of the generated Python script for reference.\n\nStep 1 [MASTER]:\n  - Master Type: farmer\n  - Input Column: Farmer Name\n  - Output Column: Farmer Name_id\n  - Lookup Path: id\n  - On Failure: Skip Row\n  - IMPORTANT: You MUST import and use 'components.master_search' for this step.\n  - The master_data_config is available in env_config, so master_search will auto-detect run_method.\n\nStep 2 [MASTER]:\n  - Master Type: soiltype\n  - Input Column: Soil Type\n  - Output Column: Soil Type_id\n  - Lookup Path: id\n  - On Failure: Skip Row\n  - IMPORTANT: You MUST import and use 'components.master_search' for this step.\n  - The master_data_config is available in env_config, so master_search will auto-detect run_method.\n\nStep 3 [MASTER]:\n  - Master Type: irrigationtype\n  - Input Column: Irrigation Type\n  - Output Column: Irrigation Type_id\n  - Lookup Path: id\n  - On Failure: Skip Row\n  - IMPORTANT: You MUST import and use 'components.master_search' for this step.\n  - The master_data_config is available in env_config, so master_search will auto-detect run_method.\n\nStep 4 [GEO]:\n  - Geo Location Logic: Create address component for each row using the column 'Address' for each row as below. Add a new column as 'Address Component (non mandatory)' to save this address. If the address is repeated in any row, use same result dont hit APIs again\n\n{\n    \"formattedAddress\" : \"Madhugiri, Karnataka 572132, India\",\n    \"postalCode\" : \"572132\",\n    \"locality\" : \"Madhugiri\",\n    \"data\" : null,\n    \"administrativeAreaLevel5\" : null,\n    \"administrativeAreaLevel4\" : null,\n    \"administrativeAreaLevel3\" : null,\n    \"administrativeAreaLevel2\" : \"Bangalore Division\",\n    \"administrativeAreaLevel1\" : \"Karnataka\",\n    \"country\" : \"India\",\n    \"latitude\" : 13.6643166,\n    \"longitude\" : 77.20889869999999,\n    \"placeId\" : \"ChIJsfkoVqO0sTsRLbvVqd06cTU\",\n    \"sublocalityLevel1\" : \"\",\n    \"sublocalityLevel2\" : \"\",\n    \"sublocalityLevel3\" : null,\n    \"sublocalityLevel4\" : null,\n    \"sublocalityLevel5\" : null,\n    \"houseNo\" : \"\",\n    \"buildingName\" : \"\",\n    \"landmark\" : \"\",\n    \"clientId\" : \"4b5c78b1-7579-4a59-8e8e-8bd35b738b8e\"\n  }\n  - IMPORTANT: You MUST import and use 'components.geofence_utils' for this step.\n  - Usage: boundary_data = geofence_utils.get_boundary(location_name, env_config.get('google_api_key'))\n  - CRITICAL: 'boundary_data' IS the direct result object. It is NOT wrapped in 'google_response' or 'data'.\n  - 'boundary_data' structure: { \"formatted_address\": \"...\", \"geometry\": { \"location\": {...}, \"viewport\": {...}, \"bounds\": {...} }, \"place_id\": \"...\", \"address_components\": [...], \"geojson_polygon\": {...} }\n  - NOTE: 'geojson_polygon' is ALREADY a FeatureCollection. DO NOT wrap it in another FeatureCollection or check for 'Polygon' type.\n  - CRITICAL: When mapping 'bounds' and 'geoInfo', ALWAYS prioritize 'geometry.bounds' over 'geometry.viewport' if available, as 'bounds' is the strict geopolitical boundary.\n  - CRITICAL: The final Output column MUST be a JSON string. Use 'json.dumps(output_payload)' to populate the row.\n  - YOU MUST PARSE 'boundary_data' directly to extract fields required by the logic (e.g. boundary_data['formatted_address'], boundary_data['geometry']['location']).\n\nStep 5 [API]:\n  - Step/Variable Name: Create Asset\n  - Call POST /services/farm/api/assets\n  - Payload Type: DTO_FILE\n  - Payload Example: {    \"declaredArea\": {        \"count\": 10    },    \"name\": \"RS A 26110201\",    \"ownerId\": 3818052,    \"soilType\": {        \"id\": 1059    },    \"irrigationType\": {        \"id\": 1107    },    \"address\": {        \"country\": \"India\",        \"formattedAddress\": \"Madhugiri, Karnataka 572132, India\",        \"administrativeAreaLevel1\": \"Karnataka\",        \"locality\": \"Madhugiri\",        \"administrativeAreaLevel2\": \"Bangalore Division\",        \"sublocalityLevel1\": \"\",        \"sublocalityLevel2\": \"\",        \"landmark\": \"\",        \"postalCode\": \"572132\",        \"houseNo\": \"\",        \"buildingName\": \"\",        \"placeId\": \"ChIJsfkoVqO0sTsRLbvVqd06cTU\",        \"latitude\": 13.6643166,        \"longitude\": 77.20889869999999    }}\n  - Expected Response: {  \"id\" : 1701,  \"name\" : \"RS A 1\",  \"companyStatus\" : \"ACTIVE\",  \"data\" : { },  \"ownerId\" : 1651,  \"ownerFirstName\" : null,  \"soilType\" : {    \"id\" : 1059,    \"name\" : null,    \"description\" : null,    \"data\" : null,    \"clientId\" : null  },  \"irrigationType\" : {    \"id\" : 1107,    \"name\" : null,    \"description\" : null,    \"clientId\" : null,    \"data\" : null  },  \"surveyNumber\" : null,  \"leased\" : null,  \"auditedArea\" : {    \"count\" : null  },  \"usableArea\" : {    \"count\" : 4.05  },  \"declaredArea\" : {    \"count\" : 4.04686  },  \"availableArea\" : null,  \"images\" : { },  \"assetStatus\" : \"AVAILABLE\",  \"clientId\" : \"95f102da-d587-4015-b390-84a854cc994e\",  \"address\" : {    \"id\" : 1303,    \"formattedAddress\" : \"Madhugiri, Karnataka 572132, India\",    \"postalCode\" : \"572132\",    \"locality\" : \"Madhugiri\",    \"data\" : null,    \"administrativeAreaLevel5\" : null,    \"administrativeAreaLevel4\" : null,    \"administrativeAreaLevel3\" : null,    \"administrativeAreaLevel2\" : \"Bangalore Division\",    \"administrativeAreaLevel1\" : \"Karnataka\",    \"country\" : \"India\",    \"latitude\" : 13.6643166,    \"longitude\" : 77.20889869999999,    \"placeId\" : \"ChIJsfkoVqO0sTsRLbvVqd06cTU\",    \"sublocalityLevel1\" : \"\",    \"sublocalityLevel2\" : \"\",    \"sublocalityLevel3\" : null,    \"sublocalityLevel4\" : null,    \"sublocalityLevel5\" : null,    \"houseNo\" : \"\",    \"buildingName\" : \"\",    \"landmark\" : \"\",    \"clientId\" : \"9f356b90-f6db-4eb2-96cb-6490d38cbc20\"  },  \"ownerCode\" : null,  \"nameCounter\" : null,  \"acreSquareAssetId\" : null,  \"lastModifiedDate\" : \"2026-02-11T14:18:16.294Z\",  \"ownerClientId\" : null,  \"externalId\" : null,  \"massUpload\" : false,  \"deleted\" : false}\n  - Instructions: Create payload using excel as below  1. Attribute 'declaredArea.count' using column 'Declared Area'  2. attribute 'name' using column 'Asset Name'  3. attribute 'ownerId' using farmer response fetched value in column 'Farmer Name_id'  4. attribute 'soilType.id' using soiltype master search 5. attribute 'irrigationType.id' using irrigation Type master search 6. attribute 'address' using parsed adress value in column 'Address Component (non mandatory)'  If the response code is 400, add the attribute 'title' value in excel column 'Response'\n\n",
    "draftSource": "AddAsset"
}